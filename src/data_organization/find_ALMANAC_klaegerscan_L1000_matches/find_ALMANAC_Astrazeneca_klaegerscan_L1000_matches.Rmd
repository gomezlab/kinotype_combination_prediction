---
title: "Find ALMANAC-Astrazeneca-klaegerscan-L1000 Drug Matches"
author: "Chinmaya Joisa"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(here)
library(webchem)
```

```{r}
#READING IN DATA
klaegerscan_cids = read_csv(here('results/matching/kinomescan_klaeger_cids.csv'))

ALMANAC_cids = read_csv(here('results/matching/ALMANAC_all_cids.csv'))

L1000_cids = read_csv(here('data/LINCS/L1000/meta_SMILES.csv')) %>% 
	rename("smiles" = SMILES, "cid" = "pubchem_cid") %>% 
  filter(!is.na(cid))
```

```{r}
#CREATING MATCH SETS
klaegerscan_ALMANAC_matches = klaegerscan_cids %>% 
	left_join(ALMANAC_cids, by = 'cid') %>%
	filter(!is.na(ALMANAC_name)) %>% 
	rename(klaegerscan_name = drug) %>% 
  #add manual matches
  bind_rows(
    tribble(
    ~klaegerscan_name, ~ALMANAC_name, ~NSC, ~cid, ~origin,
    "Pazopanib", "Pazopanib hydrochloride", "NSC-737754", 10113978, "Kinobeads"
    )) %>% 
  separate(NSC, into = c("prefix", "NSC"), sep = "-") %>% 
  select(-prefix)

L1000_ALMANAC_matches = L1000_cids %>%
	left_join(ALMANAC_cids) %>% 
	filter(!is.na(ALMANAC_name)) %>% 
	rename("broad_id" = pert_id, 
				 "L1000_name" = pert_iname) %>%
	select(broad_id, L1000_name, ALMANAC_name, NSC,cid) %>% 
  unique() %>% 
  separate(NSC, into = c("prefix", "NSC"), sep = "-") %>% 
  select(-prefix)
```

```{r}
#Write Output Files
write_csv(klaegerscan_ALMANAC_matches, here('results/matching/klaegerscan_ALMANAC_matches.csv'))
write_csv(L1000_ALMANAC_matches, here('results/matching/L1000_ALMANAC_matches.csv'))
```